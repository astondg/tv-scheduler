/*! tv-scheduler 11-04-2015 */
angular.module("tvSchedulerApp",["ngRoute"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/guide",{controller:"guideController",templateUrl:"views/guide.html"}).when("/programs",{controller:"programsController",templateUrl:"views/programs.html"}).when("/schedule",{controller:"scheduleController",templateUrl:"views/schedule.html"}).otherwise({redirectTo:"/guide"}),b.html5Mode(!0)}]),angular.module("tvSchedulerApp").controller("guideController",["$scope","channelService","programService",function(a,b,c){b.getAllChannels().then(function(b){a.channels=b}),a.viewStartTime=moment(),a.viewEndTime=moment().add(3,"hours"),c.getProgramsInTimeRange(a.viewStartTime,a.viewEndTime).then(function(b){a.programsInView=b}),a.hoursInView=["1:00pm","2:00pm","3:00pm"]}]),angular.module("tvSchedulerApp").controller("programsController",["$scope","programService",function(a,b){a.viewStartTime=moment(),a.viewEndTime=moment().add(3,"hours"),a.programsByRelativeTime=[],b.getProgramsInTimeRange(a.viewStartTime,a.viewEndTime).then(function(b){var c=_.values(_.groupBy(b,"channelId")),d=_.map(c,function(a){return a[0]});a.programsByRelativeTime.push({title:"now",startTime:_.min(d,"startTime"),showingNow:!0,programs:d});var e=_.map(c,function(a){return a[1]});a.programsByRelativeTime.push({title:"next",startTime:_.min(e,"startTime"),programs:e});var f=_.reduce(c,function(a,b){return a.programs&&b.push.apply(a.programs.slice(2)),b},[]);a.programsByRelativeTime.push({title:"later",startTime:_.min(f,"startTime"),programs:f})}),a.dateHeader=function(a){return a.showingNow?"now":a.showingNext?"next":"later"}}]),angular.module("tvSchedulerApp").directive("currentTime",function(a,b){function c(a,c){a.text(b(new Date,c))}function d(b,e){f=a(function(){c(b),d(b,e)},1e3)}function e(b,e,g){c(e,b.format),e.bind("$destroy",function(){a.cancel(f)}),d(e,b.format)}var f;return{restrict:"A",scope:{format:"=currentTime"},link:e}}),angular.module("tvSchedulerApp").directive("programOverview",function(){function a(a,b,c,d){var e=moment.max(a,c),f=moment.min(b,d);return f.diff(e,"minutes")}function b(b,c){if(b.viewStartTime&&b.viewEndTime){var d=b.viewEndTime.diff(b.viewStartTime,"minutes"),e=a(b.program.startTime,b.program.endTime,b.viewStartTime,b.viewEndTime),f=e/d*100;c[0].style.width=f+"%"}var g=moment();b.program.startTime.isBefore(g)&&b.program.endTime.isAfter(g)&&c.addClass("showing-now")}return{restrict:"E",scope:{program:"=model",viewStartTime:"=viewStartTime",viewEndTime:"=viewEndTime",isExpanded:"=isExpanded"},templateUrl:"/partials/program-overview.html",replace:!0,link:b}}),angular.module("tvSchedulerApp").factory("channelService",["$q",function(a){var b={getAllChannels:function(){return a(function(a){a([{id:1,name:"One HD",number:1,iconPath:"/img/250px-Channel_seven.jpg",tunerId:"111AAA"},{id:2,name:"ABC",number:2,iconPath:"/img/250px-Channel_seven.jpg",tunerId:"222BBB"},{id:3,name:"SBSONE",number:3,iconPath:"/img/250px-Channel_seven.jpg",tunerId:"333CCC"},{id:4,name:"Seven",number:7,iconPath:"/img/250px-Channel_seven.jpg",tunerId:"444DDD"},{id:5,name:"Nine",number:9,iconPath:"/img/250px-Channel_seven.jpg",tunerId:"555EEE"}])})}};return b}]),angular.module("tvSchedulerApp").factory("programService",["$q",function(a){var b={getProgramsInTimeRange:function(b,c){return a(function(a){a([{name:"test program 1",description:"bla bla bla this is a description of a program that is showing at a time on a channel",startTime:moment(),endTime:moment().add(60,"minutes"),channelId:1},{name:"test program 2",description:"",startTime:moment().add(60,"minutes"),endTime:moment().add(100,"minutes"),channelId:1},{name:"test program 3",description:"",startTime:moment().add(100,"minutes"),endTime:moment().add(125,"minutes"),channelId:1},{name:"test program 4",description:"",startTime:moment(),endTime:moment().add(15,"minutes"),channelId:2},{name:"test program 5",description:"",startTime:moment().add(15,"minutes"),endTime:moment().add(70,"minutes"),channelId:2},{name:"test program 6",description:"",startTime:moment().add(70,"minutes"),endTime:moment().add(160,"minutes"),channelId:2},{name:"test program 7",description:"",startTime:moment().add(-20,"minutes"),endTime:moment().add(100,"minutes"),channelId:3},{name:"test program 8",description:"",startTime:moment().add(100,"minutes"),endTime:moment().add(180,"minutes"),channelId:3},{name:"test program 9",description:"",startTime:moment(),endTime:moment().add(30,"minutes"),channelId:5},{name:"test program 10",description:"",startTime:moment().add(30,"minutes"),endTime:moment().add(60,"minutes"),channelId:5},{name:"test program 11",description:"",startTime:moment().add(60,"minutes"),endTime:moment().add(100,"minutes"),channelId:5},{name:"test program 12",description:"",startTime:moment().add(100,"minutes"),endTime:moment().add(120,"minutes"),channelId:5}])})}};return b}]);